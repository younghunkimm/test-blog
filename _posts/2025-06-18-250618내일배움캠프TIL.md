---
title: ÎÇ¥ÏùºÎ∞∞ÏõÄÏ∫†ÌîÑ ÏÇ¨Ï†ÑÏ∫†ÌîÑ Ïò®ÎùºÏù∏Í∞ïÏùò SQL 5Ï£ºÏ∞®
categories: [ÎÇ¥ÏùºÎ∞∞ÏõÄÏ∫†ÌîÑ]
tags: [ÎÇ¥ÏùºÎ∞∞ÏõÄÏ∫†ÌîÑ, ÏÇ¨Ï†ÑÏ∫†ÌîÑ, TIL]
date: '2025-06-18 18:19:00 +0900'
---

## üöÄ Í≥µÎ∂ÄÌïú ÎÇ¥Ïö©

### Í∞íÏùò Ï†úÏô∏

```sql
SELECT restaurant_name,
       AVG(rating) AS avg_rating,
       AVG(IF(rating <> 'Not given', rating, null)) AS avg_rating2
FROM food_orders
GROUP BY 1;
```

> mysqlÏóêÏÑúÎäî ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÎäî Í∞íÏùº Îïå Ìï¥Îãπ Í∞íÏùÑ `0`ÏúºÎ°ú Í∞ÑÏ£º
{: .prompt-tip}

> Î™ÖÌôïÌïòÍ≤å Ïó∞ÏÇ∞ÏùÑ ÏßÄÏ†ïÌï¥Ï£ºÍ∏∞ ÏúÑÌï¥ `null` Î¨∏Î≤ïÏùÑ ÏÇ¨Ïö©
{: .prompt-tip}

### Í∞íÏùò Î≥ÄÍ≤Ω

```sql
SELECT a.order_id,
       a.customer_id,
       a.restaurant_name,
       a.price,
       b.name,
       b.age,
       COALESCE(b.age, 20) AS "null Ï†úÍ±∞",
       b.gender
FROM food_orders a LEFT JOIN customers b ON a.customer_id=b.customer_id
WHERE b.age IS NULL;
```

> `COALESCE(a, b)` : Îëê Í∞úÏùò Ïù∏ÏûêÎ•º Î∞õÏïÑ aÏùò Í∞íÏù¥ NULL Ïù¥ÎùºÎ©¥ bÎ°ú ÎåÄÏ≤¥, bÏùò Í∞íÏù¥ NULL Ïù¥ÎùºÎ©¥ aÎ°ú ÎåÄÏ≤¥
{: .prompt-tip}

### Pivot Table

- ÏùåÏãùÏ†êÎ≥Ñ ÏãúÍ∞ÑÎ≥Ñ Ï£ºÎ¨∏Í±¥Ïàò (15 ~ 20Ïãú ÏÇ¨Ïù¥, 20Ïãú Ï£ºÎ¨∏Í±¥Ïàò Í∏∞Ï§Ä ÎÇ¥Î¶ºÏ∞®Ïàú)
  ```sql
  SELECT restaurant_name,
         MAX(IF(hh = '15', cnt_order, 0)) AS "15",
         MAX(IF(hh = '16', cnt_order, 0)) AS "16",
         MAX(IF(hh = '17', cnt_order, 0)) AS "17",
         MAX(IF(hh = '18', cnt_order, 0)) AS "18",
         MAX(IF(hh = '19', cnt_order, 0)) AS "19",
         MAX(IF(hh = '20', cnt_order, 0)) AS "20"
  FROM (
    SELECT f.restaurant_name,
           SUBSTR(p.time, 1, 2) AS hh,
           COUNT(*) AS cnt_order
    FROM food_orders AS f INNER JOIN payments AS p ON f.order_id = p.order_id
    WHERE SUBSTR(p.time, 1, 2) BETWEEN 15 AND 20
    GROUP BY 1, 2
  ) a
  GROUP BY 1
  ORDER BY 7 DESC;
  ```

  ![Image](https://private-user-images.githubusercontent.com/91935220/456414544-5c27ad9e-77fe-4f47-a66d-8712504d7a96.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NTAyMzc1MTUsIm5iZiI6MTc1MDIzNzIxNSwicGF0aCI6Ii85MTkzNTIyMC80NTY0MTQ1NDQtNWMyN2FkOWUtNzdmZS00ZjQ3LWE2NmQtODcxMjUwNGQ3YTk2LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTA2MTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwNjE4VDA5MDAxNVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTdhMzYyYjZmY2FlZWYwMzdmNDExMzZiODFmODMwMzFmMThlYzJkNzM2OTRmN2NhOWU5YWZkZDJiYTI4M2FiMTcmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.A3iXWoN5yvUxpTsSvwlxMBgahUlpJTBodak_ioU-a9w)

- ÏÑ±Î≥Ñ, Ïó∞Î†πÎ≥Ñ Ï£ºÎ¨∏Í±¥Ïàò (10 ~ 59ÏÑ∏ ÏÇ¨Ïù¥, Ïó∞Î†π ÏàúÏúºÎ°ú ÎÇ¥Î¶ºÏ∞®Ïàú)
  ```sql
  SELECT age,
         MAX(IF(gender = 'male', cnt_order, 0)) AS "male",
         MAX(IF(gender = 'female', cnt_order, 0)) AS "female"
  FROM (
    SELECT gender,
           CASE WHEN age BETWEEN 10 AND 19 THEN 10
                WHEN age BETWEEN 20 AND 29 THEN 20
                WHEN age BETWEEN 30 AND 39 THEN 30
                WHEN age BETWEEN 40 AND 49 THEN 40
                WHEN age BETWEEN 50 AND 59 THEN 50
           END AS "age",
           COUNT(*) AS "cnt_order"
    FROM food_orders f INNER JOIN customers c ON f.customer_id = c.customer_id
    WHERE age BETWEEN 10 AND 59
    GROUP BY 1, 2
  ) a
  GROUP BY 1
  ORDER BY 1 DESC;
  ```

  ![Image](https://private-user-images.githubusercontent.com/91935220/456416247-31cb075d-fd3e-4bdd-b746-f3af9201177a.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NTAyMzc2OTEsIm5iZiI6MTc1MDIzNzM5MSwicGF0aCI6Ii85MTkzNTIyMC80NTY0MTYyNDctMzFjYjA3NWQtZmQzZS00YmRkLWI3NDYtZjNhZjkyMDExNzdhLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTA2MTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwNjE4VDA5MDMxMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTM0NDBmM2ZjM2UwMzU3YzM4ODNlOTZmY2YxNzJhMGEyNDg3ZTNkZjBjMmE0ZTMyMGM2M2YwYmM3NWMxNGNlM2EmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.ao4qnz24AtJGNISq2pQhk2EJHo9NIT0BNgmXAucrHKc)

- ÏùåÏãù ÌÉÄÏûÖÎ≥Ñ, Ïó∞Î†πÎ≥Ñ Ï£ºÎ¨∏Í±¥Ïàò (10 ~ 59ÏÑ∏ ÏÇ¨Ïù¥)
  ```sql
  SELECT cuisine_type,
         MAX(IF(age = '10', cnt_order, 0)) AS "10ÎåÄ",
         MAX(IF(age = '20', cnt_order, 0)) AS "20ÎåÄ",
         MAX(IF(age = '30', cnt_order, 0)) AS "30ÎåÄ",
         MAX(IF(age = '40', cnt_order, 0)) AS "40ÎåÄ",
         MAX(IF(age = '50', cnt_order, 0)) AS "50ÎåÄ"
  FROM (
    SELECT cuisine_type,
           CASE WHEN age BETWEEN 10 AND 19 THEN 10
                WHEN age BETWEEN 20 AND 29 THEN 20
                WHEN age BETWEEN 30 AND 39 THEN 30
                WHEN age BETWEEN 40 AND 49 THEN 40
                WHEN age BETWEEN 50 AND 59 THEN 50
           END AS "age",
           COUNT(*) AS "cnt_order"
    FROM food_orders f INNER JOIN customers c ON f.customer_id = c.customer_id
    WHERE age BETWEEN 10 AND 59
    GROUP BY 1, 2
  ) a
  GROUP BY 1
  ```

  ![Image](https://private-user-images.githubusercontent.com/91935220/456416835-eebe1fe2-62b4-4b1d-b02a-ef0605bf4792.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NTAyMzc3NTMsIm5iZiI6MTc1MDIzNzQ1MywicGF0aCI6Ii85MTkzNTIyMC80NTY0MTY4MzUtZWViZTFmZTItNjJiNC00YjFkLWIwMmEtZWYwNjA1YmY0NzkyLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTA2MTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwNjE4VDA5MDQxM1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWNiMTRkYzY5Mzg3Y2Y0ZTllYzdkZTA5OTQ4MGJmMDM4MGI0YTk5MDJhNTg1MzVkNTQxNzI0ZWE5YTAzOGI1ZjMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.wd919A5xDOywjXgQG7LA8fuUuzNdC_I15Q60G2Im3BM)

### RANK

- ÏùåÏãù ÌÉÄÏûÖÎ≥ÑÎ°ú Ï£ºÎ¨∏ Í±¥ÏàòÍ∞Ä Í∞ÄÏû• ÎßéÏùÄ ÏÉÅÏ†ê 3Í∞úÏî© Ï°∞ÌöåÌïòÍ∏∞
  ```sql
  SELECT cuisine_type,
         restaurant_name,
         cnt_order,
         ranking
  FROM (
    SELECT cuisine_type,
           restaurant_name,
           cnt_order,
           RANK() OVER (PARTITION BY cuisine_type ORDER BY cnt_order DESC) AS "ranking"
    FROM (
      SELECT cuisine_type,
             restaurant_name,
             count(*) AS cnt_order
      FROM food_orders
      GROUP BY 1, 2
    ) a
  ) b
  WHERE ranking <= 3;
  ```

  ![Image](https://private-user-images.githubusercontent.com/91935220/456417211-41f642c8-2194-4eee-adfe-f9e3f4d14ec7.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NTAyMzc3OTcsIm5iZiI6MTc1MDIzNzQ5NywicGF0aCI6Ii85MTkzNTIyMC80NTY0MTcyMTEtNDFmNjQyYzgtMjE5NC00ZWVlLWFkZmUtZjllM2Y0ZDE0ZWM3LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTA2MTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwNjE4VDA5MDQ1N1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTJiYjBlOTE3YWUwMWFmYjZkYzQ3MTVmYjdmMWVlZTg5NDgzZjE1ZjI0NGYxMGU2NTljYWFlOTE5MWUxY2Q2MTYmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.lGQ50rQqbvIRVNaAyJfZWuhoJw5v9WLKtepEmj1CZTk)

### SUM

- Í∞Å ÏùåÏãùÏ†êÏùò Ï£ºÎ¨∏Í±¥Ïù¥ Ìï¥Îãπ ÏùåÏãù ÌÉÄÏûÖÏóêÏÑú Ï∞®ÏßÄÌïòÎäî ÎπÑÏú®ÏùÑ Íµ¨ÌïòÍ≥†, Ï£ºÎ¨∏Í±¥Ïù¥ ÎÇÆÏùÄ ÏàúÏúºÎ°ú Ï†ïÎ†¨ÌñàÏùÑ Îïå ÎàÑÏ†Å Ìï© Íµ¨ÌïòÍ∏∞
  ```sql
  SELECT cuisine_type,
         restaurant_name,
         cnt_order,
         SUM(cnt_order) OVER (PARTITION BY cuisine_type) AS "sum_cuisine",
         SUM(cnt_order) OVER (PARTITION BY cuisine_type ORDER BY cnt_order) AS "cum_cuisine"
  FROM (
    SELECT cuisine_type,
           restaurant_name,
           count(*) AS cnt_order
    FROM food_orders
    GROUP BY 1, 2
  ) a
  ORDER BY cuisine_type, cnt_order;
  ```

  ![Image](https://private-user-images.githubusercontent.com/91935220/456418924-4ec71d4d-08ad-4dbb-a12d-735e35614c52.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NTAyMzgwODgsIm5iZiI6MTc1MDIzNzc4OCwicGF0aCI6Ii85MTkzNTIyMC80NTY0MTg5MjQtNGVjNzFkNGQtMDhhZC00ZGJiLWExMmQtNzM1ZTM1NjE0YzUyLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTA2MTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwNjE4VDA5MDk0OFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTk2ZmVlOWQ5MTg1NmJlY2I3N2I3YmQ5Y2RjMTAzZDM1MDcwMjhjOTM4Y2I2MTEzZDU3OTQzZDZiNDBhNjI2MDUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.FuSkwXL3pyvhh-3hZqPYAaStlXvdbtNWvQUZTtgePI0)

### ÎÇ†Ïßú Îç∞Ïù¥ÌÑ∞

- Ìè¨Îß∑
  ```sql
  SELECT DATE(date) AS "date_type",
       DATE_FORMAT(DATE(date), '%Y') AS "ÎÖÑ",
       DATE_FORMAT(DATE(date), '%m') AS "Ïõî",
       DATE_FORMAT(DATE(date), '%d') AS "Ïùº",
       DATE_FORMAT(DATE(date), '%w') AS "ÏöîÏùº"
  FROM payments;
  ```

- ÎÇ†ÏßúÎ°ú GROUP BY
  ```sql
  SELECT DATE_FORMAT(DATE(date), '%Y') AS "ÎÖÑ",
         DATE_FORMAT(DATE(date), '%m') AS "Ïõî",
         DATE_FORMAT(DATE(date), '%Y%m') AS "ÎÖÑÏõî",
         COUNT(*) AS "Ï£ºÎ¨∏Í±¥Ïàò"
  FROM food_orders f INNER JOIN payments p ON f.order_id = p.order_id
  WHERE DATE_FORMAT(DATE(date), '%m') = '03'
  GROUP BY 1, 2, 3
  ORDER BY 1;
  ```

## üöÄ ÌöåÍ≥†

SQLÏùÑ ÌôúÏö©ÌïòÏó¨ Pivot TableÏùÑ ÎßåÎì§ Ïàò ÏûàÎã§Îäî Í≤ÉÏù¥ Ïã†Í∏∞ÌñàÍ≥†,   
5Ï£ºÏ∞® Í∞ïÏùòÏóêÎäî Ï°∞Í∏à Ïñ¥Î†µÏßÄÎßå Ï§ëÏöîÌïú Î¨∏Î≤ïÎì§Ïù¥ ÎßéÏù¥ ÏûàÏóàÎçò Í±∞ Í∞ôÎã§.